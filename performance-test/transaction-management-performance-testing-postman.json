{
  "info": {
    "_postman_id": "c4f5d024-ec4c-4fcf-aee6-8a0c3a917af6",
    "name": "Transaction Management - Performance Test",
    "description": "æ€§èƒ½æµ‹è¯•é›†åˆï¼šåˆ›å»º1000ä¸ªéšæœºæ•°æ®å¹¶è¿›è¡ŒQPS 100çš„1åˆ†é’Ÿæ€§èƒ½æµ‹è¯•",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "48206125",
    "_collection_link": "https://zwiebelnx-ab8ca577-260803.postman.co/workspace/3cffb2e1-16f7-400c-8ea0-02ecd8763ef3/collection/48206125-c4f5d024-ec4c-4fcf-aee6-8a0c3a917af6?action=share&source=collection_link&creator=48206125"
  },
  "item": [
    {
      "name": "1. æ•°æ®å‡†å¤‡ - åˆ›å»º1000ä¸ªéšæœºäº¤æ˜“",
      "item": [
        {
          "name": "æ‰¹é‡åˆ›å»ºéšæœºäº¤æ˜“æ•°æ®",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// è®¾ç½®è¦åˆ›å»ºçš„äº¤æ˜“æ•°é‡",
                  "const TRANSACTION_COUNT = 1000;",
                  "",
                  "// å¦‚æœè¿™æ˜¯ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œåˆå§‹åŒ–è®¡æ•°å™¨",
                  "if (!pm.collectionVariables.get('currentTransactionCount')) {",
                  "    pm.collectionVariables.set('currentTransactionCount', '0');",
                  "    pm.collectionVariables.set('totalTransactionCount', TRANSACTION_COUNT.toString());",
                  "    pm.collectionVariables.set('createdTransactionIds', JSON.stringify([]));",
                  "    console.log(pm.globals.get('currentTransactionCount'))",
                  "    console.log('ğŸš€ å¼€å§‹æ‰¹é‡åˆ›å»º1000ä¸ªéšæœºäº¤æ˜“æ•°æ®...');",
                  "}",
                  "",
                  "// è·å–å½“å‰è®¡æ•°",
                  "let currentCount = parseInt(pm.globals.get('currentTransactionCount'));",
                  "const totalCount = parseInt(pm.globals.get('totalTransactionCount'));",
                  "",
                  "if (currentCount < totalCount) {",
                  "    console.log(`æ­£åœ¨åˆ›å»ºç¬¬ ${currentCount + 1}/${totalCount} ä¸ªäº¤æ˜“...`);",
                  "} else {",
                  "    console.log('âŒ æ‰€æœ‰äº¤æ˜“å·²åˆ›å»ºå®Œæˆï¼Œè·³è¿‡æ­¤è¯·æ±‚');",
                  "    postman.setNextRequest(null);",
                  "}",
                  ""
                ],
                "type": "text/javascript",
                "packages": {}
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// æ£€æŸ¥å“åº”çŠ¶æ€",
                  "pm.test('äº¤æ˜“åˆ›å»ºæˆåŠŸ', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "// è·å–å“åº”æ•°æ®",
                  "if (pm.response.code === 201) {",
                  "    const responseJson = pm.response.json();",
                  "    ",
                  "    // ä¿å­˜äº¤æ˜“ID",
                  "    let createdIds = JSON.parse(pm.collectionVariables.get('createdTransactionIds') || '[]');",
                  "    createdIds.push(responseJson.id);",
                  "    pm.collectionVariables.set('createdTransactionIds', JSON.stringify(createdIds));",
                  "    ",
                  "    // æ›´æ–°è®¡æ•°å™¨",
                  "    let currentCount = parseInt(pm.collectionVariables.get('currentTransactionCount'));",
                  "    currentCount++;",
                  "    pm.collectionVariables.set('currentTransactionCount', currentCount.toString());",
                  "    ",
                  "    const totalCount = parseInt(pm.collectionVariables.get('totalTransactionCount'));",
                  "    ",
                  "    console.log(`å·²åˆ›å»º ${currentCount}/${totalCount} ä¸ªäº¤æ˜“`);",
                  "    ",
                  "    // å¦‚æœè¿˜æ²¡æœ‰åˆ›å»ºå®Œæ‰€æœ‰äº¤æ˜“ï¼Œç»§ç»­ä¸‹ä¸€ä¸ª",
                  "    if (currentCount < totalCount) {",
                  "        pm.execution.setNextRequest('æ‰¹é‡åˆ›å»ºéšæœºäº¤æ˜“æ•°æ®');",
                  "    } else {",
                  "        console.log('ğŸ‰ æ‰€æœ‰1000ä¸ªéšæœºäº¤æ˜“æ•°æ®åˆ›å»ºå®Œæˆï¼');",
                  "        console.log('ç°åœ¨å¯ä»¥å¼€å§‹æ€§èƒ½æµ‹è¯•äº†ã€‚');",
                  "        postman.setNextRequest(null);",
                  "    }",
                  "} else {",
                  "    console.log('äº¤æ˜“åˆ›å»ºå¤±è´¥ï¼Œåœæ­¢æ‰¹é‡åˆ›å»º');",
                  "    postman.setNextRequest(null);",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"æ‰¹é‡åˆ›å»º_{{$timestamp}}_{{$randomInt}}\",\n  \"amount\": {{$randomPrice}},\n  \"type\": \"DEPOSIT\",\n  \"category\": \"test\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/transactions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "v1",
                "transactions"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "2. æ€§èƒ½æµ‹è¯• - QPS 100æŒç»­10åˆ†é’Ÿ",
      "item": [
        {
          "name": "åˆ›å»ºäº¤æ˜“ - æ€§èƒ½æµ‹è¯•",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// æ€§èƒ½æµ‹è¯•åˆ›å»ºäº¤æ˜“ - ä½¿ç”¨Postmanå†…ç½®åŠ¨æ€å˜é‡",
                  "// æ— éœ€æ‰‹åŠ¨è®¾ç½®å˜é‡ï¼Œ{{$timestamp}}ã€{{$randomInt}}å’Œ{{$randomPrice}}ä¼šè‡ªåŠ¨ç”Ÿæˆ",
                  "// è¿™æ ·é¿å…äº†å˜é‡è®¾ç½®çš„æƒé™é—®é¢˜"
                ],
                "type": "text/javascript",
                "packages": {}
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// æ€§èƒ½æµ‹è¯•éªŒè¯",
                  "pm.test('å“åº”æ—¶é—´å°äº500ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(500);",
                  "});",
                  "",
                  "pm.test('çŠ¶æ€ç ä¸º201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('å“åº”åŒ…å«äº¤æ˜“ID', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('id');",
                  "    pm.expect(responseJson.id).to.not.be.empty;",
                  "    // ä¿å­˜äº¤æ˜“ID",
                  "    let createdIds = JSON.parse(pm.collectionVariables.get('createdTransactionIds') || '[]');",
                  "    createdIds.push(responseJson.id);",
                  "    pm.collectionVariables.set('createdTransactionIds', JSON.stringify(createdIds));",
                  "",
                  "});"
                ],
                "type": "text/javascript",
                "packages": {}
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"name\": \"æ€§èƒ½æµ‹è¯•_{{$timestamp}}_{{$randomInt}}\",\n    \"amount\": {{$randomPrice}},\n    \"type\": \"DEPOSIT\",\n    \"category\": \"test\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/transactions",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "v1",
                "transactions"
              ]
            }
          },
          "response": []
        },
        {
          "name": "æŸ¥è¯¢äº¤æ˜“ - æ€§èƒ½æµ‹è¯•",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// å…ˆè·å–å­˜åœ¨çš„äº¤æ˜“IDåˆ—è¡¨",
                  "const createdIds = JSON.parse(pm.collectionVariables.get('createdTransactionIds') || '[]');",
                  "",
                  "if (createdIds.length > 0) {",
                  "    const randomId = createdIds[Math.floor(Math.random() * createdIds.length)];",
                  "    pm.collectionVariables.set('transactionId', randomId);",
                  "} else {",
                  "    // å¦‚æœæ²¡æœ‰å·²åˆ›å»ºçš„äº¤æ˜“ï¼Œä½¿ç”¨ä¸€ä¸ªé»˜è®¤çš„ID",
                  "    pm.collectionVariables.set('transactionId', 'test-id');",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {}
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// æŸ¥è¯¢æ€§èƒ½æµ‹è¯•éªŒè¯",
                  "pm.test('æŸ¥è¯¢å“åº”æ—¶é—´å°äº200ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(200);",
                  "});",
                  "",
                  "pm.test('æŸ¥è¯¢çŠ¶æ€ç ä¸º200æˆ–404', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 404]);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    pm.test('æŸ¥è¯¢å“åº”åŒ…å«äº¤æ˜“ä¿¡æ¯', function () {",
                  "        const responseJson = pm.response.json();",
                  "        pm.expect(responseJson).to.have.property('id');",
                  "        pm.expect(responseJson).to.have.property('name');",
                  "        pm.expect(responseJson).to.have.property('amount');",
                  "    });",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {}
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/transactions/{{transactionId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "v1",
                "transactions",
                "{{transactionId}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "åˆ†é¡µæŸ¥è¯¢äº¤æ˜“ - æ€§èƒ½æµ‹è¯•",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// è®¾ç½®éšæœºçš„åˆ†é¡µå‚æ•°",
                  "const randomPage = Math.floor(Math.random() * 10) + 1; // 1-10é¡µ",
                  "const randomSize = Math.floor(Math.random() * 20) + 5; // 5-25æ¡è®°å½•",
                  "",
                  "pm.request.url.query.upsert({key: 'page', value: randomPage.toString()});",
                  "pm.request.url.query.upsert({key: 'size', value: randomSize.toString()});"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// åˆ†é¡µæŸ¥è¯¢æ€§èƒ½æµ‹è¯•éªŒè¯",
                  "pm.test('åˆ†é¡µæŸ¥è¯¢å“åº”æ—¶é—´å°äº300ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(300);",
                  "});",
                  "",
                  "pm.test('åˆ†é¡µæŸ¥è¯¢çŠ¶æ€ç ä¸º200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('åˆ†é¡µæŸ¥è¯¢å“åº”æ ¼å¼æ­£ç¡®', function () {",
                  "    const responseJson = pm.response.json();",
                  "    pm.expect(responseJson).to.have.property('data');",
                  "    pm.expect(responseJson).to.have.property('total');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/transactions?page=1&size=10",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "v1",
                "transactions"
              ],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "size",
                  "value": "10"
                }
              ]
            }
          },
          "response": []
        },
        {
          "name": "åˆ é™¤äº¤æ˜“ - æ€§èƒ½æµ‹è¯•",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// å…ˆè·å–å­˜åœ¨çš„äº¤æ˜“IDåˆ—è¡¨",
                  "const createdIds = JSON.parse(pm.collectionVariables.get('createdTransactionIds') || '[]');",
                  "",
                  "if (createdIds.length > 0) {",
                  "    toDeleteId = createdIds.shift()",
                  "    pm.collectionVariables.set('transactionToDelete', toDeleteId);",
                  "} else {",
                  "    // å¦‚æœæ²¡æœ‰å·²åˆ›å»ºçš„äº¤æ˜“ï¼Œä½¿ç”¨ä¸€ä¸ªé»˜è®¤çš„ID",
                  "    pm.collectionVariables.set('transactionToDelete', 'test-id');",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {}
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// åˆ é™¤æ“ä½œæ€§èƒ½æµ‹è¯•éªŒè¯",
                  "pm.test('åˆ é™¤å“åº”æ—¶é—´å°äº300ms', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(300);",
                  "});",
                  "",
                  "pm.test('åˆ é™¤çŠ¶æ€ç ä¸º204æˆ–404', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([204, 404]);",
                  "});",
                  "",
                  "// è®°å½•åˆ é™¤æ“ä½œçš„ç»Ÿè®¡ä¿¡æ¯",
                  "if (!pm.globals.get('deleteMetrics')) {",
                  "    pm.globals.set('deleteMetrics', JSON.stringify({",
                  "        totalDeleteRequests: 0,",
                  "        successfulDeletes: 0,",
                  "        notFoundDeletes: 0,",
                  "        totalDeleteResponseTime: 0",
                  "    }));",
                  "}",
                  "",
                  "let deleteMetrics = JSON.parse(pm.globals.get('deleteMetrics'));",
                  "deleteMetrics.totalDeleteRequests++;",
                  "deleteMetrics.totalDeleteResponseTime += pm.response.responseTime;",
                  "",
                  "if (pm.response.code === 204) {",
                  "    deleteMetrics.successfulDeletes++;",
                  "    console.log('âœ… äº¤æ˜“åˆ é™¤æˆåŠŸ:', pm.collectionVariables.get('transactionToDelete'));",
                  "} else if (pm.response.code === 404) {",
                  "    deleteMetrics.notFoundDeletes++;",
                  "    console.log('â„¹ï¸ äº¤æ˜“ä¸å­˜åœ¨:', pm.collectionVariables.get('transactionToDelete'));",
                  "}",
                  "",
                  "pm.globals.set('deleteMetrics', JSON.stringify(deleteMetrics));",
                  "",
                  "// æ¯50ä¸ªåˆ é™¤è¯·æ±‚è¾“å‡ºä¸€æ¬¡ç»Ÿè®¡",
                  "if (deleteMetrics.totalDeleteRequests % 50 === 0) {",
                  "    const avgDeleteTime = (deleteMetrics.totalDeleteResponseTime / deleteMetrics.totalDeleteRequests).toFixed(2);",
                  "    const successRate = ((deleteMetrics.successfulDeletes / deleteMetrics.totalDeleteRequests) * 100).toFixed(2);",
                  "    ",
                  "    console.log(`ğŸ—‘ï¸ åˆ é™¤æ“ä½œç»Ÿè®¡ (${deleteMetrics.totalDeleteRequests}ä¸ªè¯·æ±‚):`);",
                  "    console.log(`   æˆåŠŸåˆ é™¤: ${deleteMetrics.successfulDeletes}ä¸ª`);",
                  "    console.log(`   æœªæ‰¾åˆ°: ${deleteMetrics.notFoundDeletes}ä¸ª`);",
                  "    console.log(`   æˆåŠŸç‡: ${successRate}%`);",
                  "    console.log(`   å¹³å‡å“åº”æ—¶é—´: ${avgDeleteTime}ms`);",
                  "}"
                ],
                "type": "text/javascript",
                "packages": {}
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/transactions/{{transactionToDelete}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "v1",
                "transactions",
                "{{transactionToDelete}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "3. è¾…åŠ©å·¥å…·",
      "item": [
        {
          "name": "æ¸…ç†æµ‹è¯•æ•°æ®",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// é‡ç½®è®¡æ•°å™¨å’Œæµ‹è¯•æ•°æ®",
                  "pm.collectionVariables.set('currentTransactionCount', 0);",
                  "pm.collectionVariables.unset('totalTransactionCount', 1000);",
                  "pm.collectionVariables.unset('createdTransactionIds', []);",
                  "",
                  "console.log('âœ… æµ‹è¯•æ•°æ®å’Œè®¡æ•°å™¨å·²æ¸…ç†å®Œæˆ');",
                  "console.log('ğŸ“Š å·²æ¸…ç†çš„æ•°æ®åŒ…æ‹¬:');",
                  "console.log('   - æ‰¹é‡åˆ›å»ºè®¡æ•°å™¨');",
                  "console.log('   - å·²åˆ›å»ºäº¤æ˜“IDåˆ—è¡¨');",
                  "console.log('   - æ€§èƒ½æµ‹è¯•æŒ‡æ ‡');",
                  "console.log('   - åˆ é™¤æ“ä½œæŒ‡æ ‡');",
                  "",
                  "// è·³è¿‡å®é™…è¯·æ±‚",
                  "postman.setNextRequest(null);"
                ],
                "type": "text/javascript",
                "packages": {}
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/transactions?page=1&size=1",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "api",
                "v1",
                "transactions"
              ],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "size",
                  "value": "1"
                }
              ]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "transactionId",
      "value": "",
      "type": "string"
    },
    {
      "key": "transactionToDelete",
      "value": "",
      "type": "string"
    },
    {
      "key": "randomName",
      "value": "",
      "type": "string"
    },
    {
      "key": "randomAmount",
      "value": "",
      "type": "string"
    },
    {
      "key": "currentTransactionCount",
      "value": ""
    },
    {
      "key": "totalTransactionCount",
      "value": ""
    },
    {
      "key": "createdTransactionIds",
      "value": ""
    }
  ]
}